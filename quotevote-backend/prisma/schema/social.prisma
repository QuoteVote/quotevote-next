// Social models: Roster, UserInvite, UserReport, BotReport, UserReputation

model Roster {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  userId      String       @db.ObjectId
  buddyId     String       @db.ObjectId
  status      RosterStatus @default(pending)
  initiatedBy String?      @db.ObjectId
  created     DateTime     @default(now())
  updated     DateTime     @updatedAt

  // Relations
  user  User @relation("RosterUser", fields: [userId], references: [id])
  buddy User @relation("RosterBuddy", fields: [buddyId], references: [id])

  @@unique([userId, buddyId])
  @@index([userId])
  @@index([buddyId])
  @@index([status])
  @@map("rosters")
}

model UserInvite {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  email       String
  invitedById String?      @db.ObjectId
  inviteeId   String?      @db.ObjectId
  code        String?      @unique
  status      InviteStatus @default(pending)
  created     DateTime     @default(now())
  expiresAt   DateTime?

  // Relations
  invitedBy User? @relation("InviteSender", fields: [invitedById], references: [id])
  invitee   User? @relation("InviteRecipient", fields: [inviteeId], references: [id])

  @@index([email])
  @@index([invitedById])
  @@index([status])
  @@map("userinvites")
}

model UserReport {
  id             String       @id @default(auto()) @map("_id") @db.ObjectId
  reportedUserId String       @db.ObjectId
  reporterId     String       @db.ObjectId
  reason         String
  status         ReportStatus @default(pending)
  created        DateTime     @default(now())

  // Relations
  reportedUser User @relation("ReportedUser", fields: [reportedUserId], references: [id])
  reporter     User @relation("Reporter", fields: [reporterId], references: [id])

  @@index([reportedUserId])
  @@index([reporterId])
  @@index([status])
  @@map("userreports")
}

model BotReport {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String   @db.ObjectId
  reporterId String   @db.ObjectId
  created    DateTime @default(now())

  // Relations
  reportedUser User @relation("BotReportedUser", fields: [userId], references: [id])
  reporter     User @relation("BotReporter", fields: [reporterId], references: [id])

  @@index([userId])
  @@index([reporterId])
  @@map("botreports")
}

// Composite type for reputation metrics
type ReputationMetrics {
  totalInvitesSent         Int   @default(0)
  totalInvitesAccepted     Int   @default(0)
  totalInvitesDeclined     Int   @default(0)
  averageInviteeReputation Float @default(0)
  totalReportsReceived     Int   @default(0)
  totalReportsResolved     Int   @default(0)
  totalUpvotes             Int   @default(0)
  totalDownvotes           Int   @default(0)
  totalPosts               Int   @default(0)
  totalComments            Int   @default(0)
}

model UserReputation {
  id                 String            @id @default(auto()) @map("_id") @db.ObjectId
  userId             String            @unique @db.ObjectId
  overallScore       Float             @default(0)
  inviteNetworkScore Float             @default(0)
  conductScore       Float             @default(0)
  activityScore      Float             @default(0)
  metrics            ReputationMetrics
  lastCalculated     DateTime          @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([overallScore])
  @@map("userreputations")
}
